# HTTP API

http api를 직접 설계해보자.

가장 중요한 것은 **리소스 식별**!



### 요구사항

- 회원목록조회
- 회원조회
- 회원등록
- 회원수정
- 회원삭제



### API URI 고민

- 리소스의 의미는 뭘까?
  - 회원을 등록/수정/조회....
  - 리소스는 '회원'
- 리소스를 어떻게 식별하는게 좋을까?
  - 등록/수정/조회... 배제!
  - 회원이라는 리소스만 식별하면 된다.



### API URI 설계

- 회원목록조회 -> /members
- 회원조회 -> /members/{id}
- 회원등록 -> /members/{id}
- 회원수정 -> /members/{id}
- 회원삭제 -> /members/{id}

> 참고: 계층 구조상 상위를 컬렉션으로 보고 복수단어 사용 권장(member -> members)



### 리소스와 행위를 분리

#### 가장 중요한 것은 리소스를 식별하는 것!

- uri는 리소스만 식별
- 리소스와 해당 리소스를 대상으로 하는 행위를 분뤼
- 리소스 : 회원
- 행위 : 등록/조회/수정/삭제..
- 그렇다면 행위는 어떻게 구분할까? => **HTTP 메서드**





## HTTP 메서드

주요 메서드

- GET: 리소스 조회
- POST: 요청 데이터 처리. 주로 등록.
- PUT: 리소스 대체. 해당 리소스가 없으면 생성.
- PATCH: 리소스 부분 변경
- DELETE: 리소스 삭제





### GET

- 리소스 조회
- 서버에 전달하고 싶은 데이터는 query(쿼리 파라미터, 쿼리 스트링)를 통해서 전달
- 메세지 바디를 사용해서 데이터를 전달할 수 있긴 하다.. 하지만 지원하지 않는 곳이 많아서 권장하지 않음.



### POST

- 요청 데이터 처리
- 메세지 바디를 통해 서버로 요청 데이터 전달
- 서버는 요청 데이터를 처리
  - 메세지 바디를 통해 들어온 데이터를 처리하는 모든 기능을 수행한다.

- 주로 전달된 데이터로 신규 리소스를 등록, 프로세스 처리에 사용



### POST가 가지는 의미

1. 새 리소스를 생성
2. 요청 데이터 처리
   - 단순히 생성,변경 하는것이 아닌 프로레스를 처리해야 하는 경우
   - ex) orders/{}/start-delivery
3. 다른 메서드로 처리하기 애매한 경우
   - JSON으로 조회 데이터를 넘겨야 하는데, GET 메서드를 사용하기 어려운 경우
   - 뭔가... 애매한 경우



### PUT

- 리소스 있으면 대체/ 없으면 생성
- 쉽게 이야기해서 덮어버린다.
- **클라이언트가 리소스를 식별**
  - 클라이언트가 리소스의 위치를 알고 URI 지정
  - POST와의 차이점
- PUT은 기존 리소스를 완전히 대체하기 때문에 부분변경 시 PATCH를 사용



### PATCH

- 부분 변경할 때 사용
- 지원이 안되는 서버가 종종 있을 수 있음 -> POST 사용하면 된다.





## HTTP 메서드의 속성

- 안전
- 멱등
- 캐시



### 안전 

- 여러번 호출해도 리소스가 변경되지 않을 때 안전하다 라고 말한다.

### 멱등(Idempotent)

- 여러번 호출해도 결과가 똑같다.
- 멱등 메서드
  - GET
  - PUT : 요청값으로 완전히 대체하기 때문에 결과 동일
  - DELETE : 삭제된 결과는동일
  - POST : 아니다! 같은 결과가 중복해서 발행할 수 있다.
- 활용
  - 자동 복구 메커니즘
  - 서버가 정상 응답을 못주었을 때, 클라이언트가 같은 요청을 다시해도 되는가? 판단 근거
- 외부 요인으로 중간에 리소스가 변경되는 것 까지는 고려 X

### 캐시 가능 (cacheable)

- 응답 결과 리소스를 캐시해서 사용해도 되는가?





## HTTP 메서드 활용

### 클라이언트에서 서버로 데이터 전송

### 2가지 방법

1. 쿼리 파라미터를 통한 데이터 전송
   - GET
   - 주로 정렬 필터(검색어)

2. 메세지 바디를 통한 데이터 전송



### 4가지 상황

- 정적 데이터 조회
- 동적 데이터 조회
- Html form 데이터 전송
  - Html form submit 시 POST 전송
  - Content-Type: application/x-www-form-urlencoded 사용
    - form의 내용을 메세지 바디를 통해서 전송(key=value, 쿼리 파라미터 형식)
    - 전송 데이터를 uri 인코딩 처리
      - ex) abc김 -> abc%EA%B9%80
  - Html form은 GET 전송도 가능
  - Content-Type: multipart/form-data
    - 파일 업로드같은 바이너리 데이터 전송 시 사용
    - 다른 종류의 여러 파일과 폼의 내용을 함께 전송 가능하다.
  - 참고) GET,POST만 지원
- http api 데이터 전송
  - 서버 to 서버
  - 앱 클라리런트
    - 아이폰, 안드로이드
  - 웹 클라이언트
    - Html 에서 form 전송 대신 자바스크립트를 통한 통신에 사용 (ajax)
    - ex) react, vuejs 같은 웹 클라이언트와 api 통신
  - Content-Type: application/json



## HTTP API 설계 예시

- **POST** 신규자원 등록 특징
  - ex) POST /members 
    - response: locaiton: members/100
  
  - 클라이언트는 등록될 리소스의 URI를 모른다.
  - 서버가 새로 등록된 리소스URI를 생성해준다.
  - **컬렉션**
    - 서버가 관리하는 리소스 디렉토리
    - 서버가 리소소의 URI를 생성하고 관리
    - 여기서 컬렉션은 /members
  
- **PUT** 기반 등록
  - 클라이언트가 리소스의 URI를 알고있어야 한다.
  - 클라이언트가 직접 리소스의 URI를 지정한다.
  - **스토어**
    - 클라이언트가 관리하는 리소스 저장소
    - 클라이언트가 리소의 URI를 알고 관리



### HTML FORM 사용

- GET, POST만 지원
- 컨트롤 URI
  - 동사로 된 리소스 경로 사용
    -  /new, /edit, delete
  - HTTP 메서드로 해결하기 애매한 경우 사용



### 정리

### 참고하면 좋은 URI 설계 개념

- 문서
  - 단일개념
  - /members/100, /fiiles/start.jpg
- 컬렉션
  - 서버가 관리하는 리소스 디렉토리
  - /memeber
- 스토어
  - 클라이언트가 관리하는 자원 저장소
  - /files

- 컨트롤러, 컨트롤 URI
  - 문서, 컬렉션, 스토어로 해결하기 어려운 추가 프로세스 실행
  - 동사를 직접 사용
  - /members/{id}/delete



참고 사이트 : [REST API Tutorial > REST Resource Naming Guide](https://restfulapi.net/resource-naming)

